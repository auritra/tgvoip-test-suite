Call Quality Estimation
====================

### Build libtgvoip

```sh
cd src/libtgvoip

autoconf && \
rm -f aclocal.m4 && \
aclocal && \
libtoolize --force && \
automake --add-missing && \
autoreconf && \
./configure --without-pulse --disable-logging

make
make install
```



### Build tgvoipcall and tgvoiprate

```
cd src/contest
mkdir build && cd build
cmake -DBUILD_CALL=ON -DBUILD_RATE=ON -DCMAKE_BUILD_TYPE=Release ..
cmake --build .
```

There are two more cmake options:

- STATIC_TGVOIP

  Specify `-DSTATIC_TGVOIP=ON` to link `libtgvoip` statically.

- TGVOIP_PATH

  Taken into account only when the previous option is set. Add `-DTGVOIP_PATH=/path/to/libtgvoip/.libs` to specify a directory where compiled libtgvoip is to be searched.



### Model estimation

To calibrate and estimate the rating model a number of degraded samples were recorded using Docker, netem and my tgvoipcall. Then [a Telegram bot](https://github.com/raid-7/SoundQualityCrowdsourcer) was created, [deployed](https://t.me/SQCrowdsourcerBot) and advertised in a few chats. Thanks to the bot and community 220 samples were rated. The final dataset can be found [here](https://yadi.sk/d/Kr2jM0u1VrINJg).

My tgvoiprate shows 1.8 mean score computed in accordance with the contest description.



### Changes introduced to libtgvoip

- Add method `VoIPController::SetPredefinedAudioIO(audio::AudioIO* io)`
- Add constructor `ServerConfig::ServerConfig(const json11::Json& config)`
- Add static method `ServerConfig::SetSharedInstance(ServerConfig* instance)`
- Change logging stream to `stderr`
- Add configure option `--disable-logging`

Totally 6 files are affected disregarding autogenerated ones. 

```
 Makefile.am          |  5 +++++
 VoIPController.cpp   | 11 +++++++++--
 VoIPController.h     |  7 +++++++
 VoIPServerConfig.cpp | 10 ++++++++++
 VoIPServerConfig.h   |  5 +++++
 configure.ac         |  3 +++
 logging.h            |  2 +-
 7 files changed, 40 insertions(+), 3 deletions(-)
```



### Dependencies rationale

`libssl-dev`, `libopus-dev`  and at least one of `libpulse-dev` and `libasound-dev` are required by `libtgvoip`. `libasound-dev` was chosen because it pulls fewer dependencies.

According to the contest description the utilities must support `.opus` files. However, the samples were represented by OPUS wrapped into OGG containers. Consequently, only `libopus` cannot be relied on for sound IO.

The next 4 libraries being a part of FFmpeg project provide awesome support for audio file IO.

- `libavcodec-dev`

- `libavformat-dev`

- `libavutil-dev`

- `libavresample-dev`
